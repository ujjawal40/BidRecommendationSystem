Error processing line 1 of /Users/ujjawaldwivedi/anaconda3/lib/python3.11/site-packages/distutils-precedence.pth:

  Traceback (most recent call last):
    File "<frozen site>", line 186, in addpackage
    File "<string>", line 1, in <module>
  ModuleNotFoundError: No module named '_distutils_hack'

Remainder of file ignored
/Users/ujjawaldwivedi/anaconda3/lib/python3.11/site-packages/pandas/core/arrays/masked.py:61: UserWarning: Pandas requires version '1.3.6' or newer of 'bottleneck' (version '1.3.5' currently installed).
  from pandas.core import (
The figure layout has changed to tight
divide by zero encountered in divide
================================================================================
LIGHTGBM BID FEE PREDICTOR - PHASE 1A
================================================================================
Timestamp: 2026-01-21 19:38:50

================================================================================
LOADING DATA
================================================================================
✓ Data loaded from: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/data/features/BidData_features.csv
  Rows: 114,503
  Columns: 123
✓ Data sorted by BidDate
  Full date range: 2018-01-02 00:00:00 to 2025-12-19 00:00:00
  Total records: 114,503

================================================================================
FILTERING TO RECENT DATA
================================================================================

✓ Filtered to data from 2023-01-01 onwards
  Original records: 114,503
  Filtered records: 52,308
  Removed: 62,195 (54.3%)
  New date range: 2023-01-03 00:00:00 to 2025-12-19 00:00:00
  Timespan: 3.0 years

================================================================================
PREPARING FEATURES
================================================================================
Total columns: 123
Excluded columns: 10
Feature columns: 84

⚠ Warning: 235204 missing values found in features
  Filling with 0...

✓ Features prepared
  Feature matrix shape: (52308, 84)
  Target variable: BidFee
  Target shape: (52308,)
  Target mean: $3,258.88
  Target std: $2,148.46

================================================================================
FEATURE SELECTION - TOP 68
================================================================================

✓ Feature selection loaded
  Selected features (optimal): 68
  Available in dataset: 68
  Original features: 84
  Features removed: 16

✓ Using optimized feature set (68 features)
  Expected improvement: ~6% better RMSE

================================================================================
TIME-BASED TRAIN/VALIDATION/TEST SPLIT
================================================================================
Split ratio: 60% train / 20% validation / 20% test

Training set:
  Rows: 31,384
  Date range: 2023-01-03 00:00:00 to 2024-11-14 00:00:00
  Target mean: $3,179.08

Validation set (for early stopping):
  Rows: 10,462
  Date range: 2024-11-14 00:00:00 to 2025-06-17 00:00:00
  Target mean: $3,359.07

Test set (held out):
  Rows: 10,462
  Date range: 2025-06-17 00:00:00 to 2025-12-19 00:00:00
  Target mean: $3,398.08

================================================================================
TRAINING LIGHTGBM MODEL
================================================================================
Training configuration (AGGRESSIVE REGULARIZATION):
  Boosting rounds: 500 (reduced from 1000)
  Early stopping: 50 rounds (on validation set)
  Learning rate: 0.05
  Num leaves: 20 (reduced from 31)
  Max depth: 8 (capped from unlimited)
  Min child samples: 30 (increased from 20)
  Regularization: L1=1.0, L2=1.0 (50x increase)

Training in progress...

Training until validation scores don't improve for 50 rounds
[50]	valid's rmse: 664.961
[100]	valid's rmse: 462.892
[150]	valid's rmse: 412.892
[200]	valid's rmse: 388.891
[250]	valid's rmse: 374.551
[300]	valid's rmse: 368.94
[350]	valid's rmse: 359.684
[400]	valid's rmse: 354.542
[450]	valid's rmse: 353.68
[500]	valid's rmse: 350.947
Did not meet early stopping. Best iteration is:
[500]	valid's rmse: 350.947

✓ Model training complete
  Best iteration: 500
  Best score: 350.95

================================================================================
MODEL EVALUATION - OVERFITTING ANALYSIS
================================================================================
Performance Across All Sets:
  Set                  RMSE          MAE    % Error
  ------------ ------------ ------------ ----------
  Train        $    165.42 $     65.07       5.2%
  Validation   $    350.95 $    109.07      10.4%
  Test         $    328.75 $    102.44       9.7%

Overfitting Analysis:
  Valid/Train ratio: 2.12x
  Test/Train ratio:  1.99x
  Status: ⚠ Moderate overfitting (acceptable)

Test Set Metrics:
  RMSE: $328.75
  MAE: $102.44
  R²: 0.9761
  MAPE: inf%
  Median AE: $31.80

Test Prediction Statistics:
  Mean prediction: $3,404.11
  Std prediction: $2,057.96
  Min prediction: $-250.52
  Max prediction: $16,328.63

================================================================================
FEATURE IMPORTANCE ANALYSIS
================================================================================

Top 30 Most Important Features:
                     feature   importance
             segment_avg_fee 7.815485e+11
               state_avg_fee 1.051625e+11
        propertytype_avg_fee 4.641845e+10
                  TargetTime 3.727000e+10
     rolling_avg_fee_segment 2.736124e+10
              client_avg_fee 2.306953e+10
    rolling_avg_fee_proptype 1.824371e+10
             segment_std_fee 1.767693e+10
            segment_win_rate 1.672992e+10
              office_avg_fee 9.008394e+09
           distance_x_volume 8.729402e+09
     PropertyState_frequency 8.440832e+09
              client_std_fee 8.400148e+09
     BusinessSegment_encoded 7.290046e+09
        propertytype_std_fee 4.864262e+09
            RooftopLongitude 4.302174e+09
                DistanceInKM 4.203493e+09
                    OfficeId 3.761380e+09
             RooftopLatitude 3.548469e+09
         TargetTime_Original 3.189590e+09
              office_std_fee 3.008751e+09
      rolling_avg_fee_office 2.956547e+09
               state_std_fee 2.459718e+09
   BusinessSegment_frequency 2.396447e+09
   Bid_Property_Type_encoded 1.878552e+09
targettime_ratio_to_proptype 1.660233e+09
    rolling_bid_count_office 1.629947e+09
   avg_historical_fee_client 1.608342e+09
              state_win_rate 1.420118e+09
       PropertyState_encoded 1.385992e+09

✓ Feature importance plot saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/figures/lightgbm_feature_importance.png
✓ Feature importance saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/reports/lightgbm_feature_importance.csv

================================================================================
SHAP EXPLAINABILITY ANALYSIS
================================================================================
Computing SHAP values for 1000 samples...
✓ SHAP summary plot saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/figures/lightgbm_shap_summary.png

================================================================================
SAVING MODEL ARTIFACTS
================================================================================
✓ Model saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/models/lightgbm_bidfee_model.txt
✓ Metadata saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/models/lightgbm_metadata.json
✓ Predictions saved: /Users/ujjawaldwivedi/Desktop/BidRecommendationSystem/outputs/reports/lightgbm_predictions.csv

================================================================================
PIPELINE COMPLETE
================================================================================
✓ LightGBM model trained and evaluated successfully
  Final RMSE: $328.75
  Final R²: 0.9761

